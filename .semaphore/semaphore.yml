version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: Checkout
    task:
      jobs:
        - name: Checkout
          commands:
            - checkout
    dependencies:
      - Setup
  - name: Setup
    dependencies: []
    task:
      jobs:
        - name: Setup .NET Core
          commands:
            - sudo apt-get update
            - sudo apt-get install wget
            - 'wget https://packages.microsoft.com/config/ubuntu/18.04/packages-microsoft-prod.deb -O packages-microsoft-prod.deb'
            - sudo dpkg -i packages-microsoft-prod.deb
            - sudo apt-get update
            - sudo apt-get install -y apt-transport-https
            - sudo apt-get update
            - sudo apt-get install -y dotnet-sdk-5.0
            - dotnet --info
  - name: 'Restore, Build, Test'
    dependencies:
      - Checkout
      - Setup
    task:
      env_vars:
        - name: FOO_1
          value: BAR_1
      jobs:
        - name: KataCombinatorics
          commands:
            - dotnet restore KataCombinatorics/KataCombinatorics.sln
            - dotnet build KataCombinatorics/KataCombinatorics.sln --no-restore
            - dotnet test KataCombinatorics/KataCombinatorics.sln --no-build --verbosity normal
